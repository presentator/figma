(function(){"use strict";const n={MESSAGE_INIT_APP:"init_app",MESSAGE_NOTIFY:"notify",MESSAGE_CLOSE:"close",MESSAGE_RESIZE_UI:"resize_ui",MESSAGE_GET_FRAMES:"get_frames",MESSAGE_GET_FRAMES_RESPONSE:"get_frames_response",MESSAGE_EXPORT_FRAME:"export_frame",MESSAGE_EXPORT_FRAME_RESPONSE:"export_frame_response",MESSAGE_SAVE_STORAGE:"save_storage"},E="presentator_storage",i=450,o=390,s={format:"PNG",contentsOnly:!0,constraint:{type:"SCALE",value:1}};async function _(){let t;try{t=await figma.clientStorage.getAsync(E)}catch(a){console.log("Storage init error:",a)}figma.showUI(__html__,{width:i,height:o}),figma.ui.postMessage({type:n.MESSAGE_INIT_APP,data:t||{}})}function S(t=!1){const a=[],e=(t?figma.currentPage.selection:figma.currentPage.children)||[];for(const r of e)r.type==="FRAME"&&r.visible&&a.push({node:r,id:r.id,name:r.name,width:r.width,height:r.height});return a}function c(t){const a=S();for(let e=a.length-1;e>=0;e--)if(a[e].id==t)return a[e];return null}async function f(t,a){try{const e=c(t);if(e&&e.node)return await e.node.exportAsync(Object.assign({},s,a||{}))}catch(e){console.log("Export frame error:",e)}return null}_(),figma.ui.onmessage=async t=>{if(!(typeof t!="object"||t===null))switch(t.type){case n.MESSAGE_SAVE_STORAGE:return figma.clientStorage.setAsync(E,t.data||{});case n.MESSAGE_CLOSE:return figma.closePlugin();case n.MESSAGE_NOTIFY:return figma.notify(t.data.message,{timeout:(t.data.timeout||4e3)<<0});case n.MESSAGE_RESIZE_UI:return figma.ui.resize((t.data.width||i)<<0,(t.data.height||o)<<0);case n.MESSAGE_GET_FRAMES:let a=S(t.data.onlySelected);return figma.ui.postMessage({state:t.state,type:n.MESSAGE_GET_FRAMES_RESPONSE,data:a});case n.MESSAGE_EXPORT_FRAME:let e=await f(t.data.id,t.data.settings);return figma.ui.postMessage({state:t.state,type:n.MESSAGE_EXPORT_FRAME_RESPONSE,data:e})}}})();
