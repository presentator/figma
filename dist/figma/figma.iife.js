(function(){"use strict";const i={MESSAGE_INIT_APP:"init_app",MESSAGE_NOTIFY:"notify",MESSAGE_CLOSE:"close",MESSAGE_RESIZE_UI:"resize_ui",MESSAGE_GET_NODES:"get_nodes",MESSAGE_GET_NODES_RESPONSE:"get_nodes_response",MESSAGE_EXPORT_NODE:"export_node",MESSAGE_EXPORT_NODE_RESPONSE:"export_node_response",MESSAGE_SAVE_STORAGE:"save_storage"},E="presentator_storage",o=450,r=390,S={format:"PNG",contentsOnly:!0,constraint:{type:"SCALE",value:1}};async function s(){let t;try{t=await figma.clientStorage.getAsync(E)}catch(n){console.log("Storage init error:",n)}figma.showUI(__html__,{width:o,height:r}),figma.ui.postMessage({type:i.MESSAGE_INIT_APP,data:t||{}})}function c(t=!1){const n=[],e=(t?figma.currentPage.selection:figma.currentPage.children)||[];for(let a=e.length-1;a>=0;a--)e[a].visible&&n.push({id:e[a].id,name:e[a].name,width:e[a].width,height:e[a].height});return n}function _(t){const n=figma.currentPage.selection.concat(figma.currentPage.children);for(let e=n.length-1;e>=0;e--)if(n[e].id==t&&n[e].visible)return n[e];return null}async function u(t,n){try{const e=_(t);if(e)return await e.exportAsync(Object.assign({},S,n||{}))}catch(e){console.log("Export node error:",e)}return null}s(),figma.ui.onmessage=async t=>{if(!(typeof t!="object"||t===null))switch(t.type){case i.MESSAGE_SAVE_STORAGE:return figma.clientStorage.setAsync(E,t.data||{});case i.MESSAGE_CLOSE:return figma.closePlugin();case i.MESSAGE_NOTIFY:return figma.notify(t.data.message,{timeout:(t.data.timeout||4e3)<<0});case i.MESSAGE_RESIZE_UI:return figma.ui.resize((t.data.width||o)<<0,(t.data.height||r)<<0);case i.MESSAGE_GET_NODES:return figma.ui.postMessage({state:t.state,type:i.MESSAGE_GET_NODES_RESPONSE,data:c(t.data.onlySelected)});case i.MESSAGE_EXPORT_NODE:let n=await u(t.data.id,t.data.settings);return figma.ui.postMessage({state:t.state,type:i.MESSAGE_EXPORT_NODE_RESPONSE,data:n})}}})();
